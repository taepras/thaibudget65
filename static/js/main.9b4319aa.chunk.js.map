{"version":3,"sources":["logo.svg","components/FullView.jsx","components/Treemap.jsx","App.jsx","reportWebVitals.js","index.jsx"],"names":["FullView","styled","div","Treemap","data","isLoading","padding","filters","setFilters","hierarchyBy","useDimensions","onResize","observe","unobserve","w","h","entr","width","height","history","entry","useHistory","svgRef","useRef","useState","displayMode","nestedData","useMemo","console","log","out","nest","i","key","d","inData","values","rollup","leaves","d3","l","AMOUNT","entries","filter","useEffect","current","svgHeight","clientHeight","root","sum","value","sort","a","b","svg","size","treemap","select","treemapPieceGroup","domain","range","selectAll","treemapPieceGroupEnter","enter","append","attr","treemapPieceMerged","merge","on","e","dx","x0","dy","y0","sx","x1","sy","y1","transition","duration","p","setTimeout","newFilters","push","process","join","style","text","toLocaleString","exit","delay","remove","ref","position","top","left","right","bottom","display","flexDirection","overflowY","backgroundColor","alignItems","justifyContent","marginBottom","background","zIndex","transform","className","marginTop","App","setData","setLoading","searchQuery","setSearchQuery","then","preprocessedData","map","parseFloat","replace","OUTPUT_PROJECT","OUTPUT","PROJECT","MINISTRY","trim","FISCAL_YEAR","datum","query","searchLevels","includes","filterDataByQuery","location","useLocation","f","pathname","split","slice","length","paddingLeft","paddingRight","overflowX","flexGrow","x","type","onClick","temp","splice","navigateTo","marginRight","border","color","opacity","textDecoration","onInput","target","placeholder","paddingTop","fontSize","href","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.9b4319aa.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.6ce24c58.svg\";","import React from 'react';\nimport styled from 'styled-components';\n\nconst FullView = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  flex-direction: column;\n`;\n\nexport default FullView;\n","import React, {\n  useEffect, useMemo, useRef, useState,\n} from 'react';\n\nimport * as d3 from 'd3';\nimport { nest } from 'd3-collection';\nimport useDimensions from 'react-cool-dimensions';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport FullView from './FullView';\n\nfunction Treemap({\n  data = [],\n  isLoading = true,\n  padding = 16,\n  filters = ['all'],\n  setFilters = () => { },\n  hierarchyBy = [],\n}) {\n  const {\n    observe, unobserve, width, height, entry,\n  } = useDimensions({\n    onResize: ({\n      /* eslint-disable-next-line no-shadow */\n      observe, unobserve, w, h, entr,\n    }) => {\n      unobserve();\n      observe();\n    },\n  });\n\n  const history = useHistory();\n\n  const svgRef = useRef(null);\n\n  // const [data, setData] = useState([]);\n  const [displayMode, setDisplayMode] = useState('treemap'); // or 'bar'\n\n  const nestedData = useMemo(\n    () => {\n      console.log('filters', filters);\n\n      let out = nest();\n      // eslint-disable-next-line guard-for-in, no-restricted-syntax\n      for (const i in filters) {\n      // for (const i in hierarchyBy) {\n        // console.log(hierarchyBy[i], filters[i])\n        out = out.key((d) => d[hierarchyBy[i]]);\n      }\n\n      const nested = out\n        .rollup((leaves) => d3.sum(leaves, (l) => l.AMOUNT))\n        .entries(data);\n\n      let inData = {\n        key: 'root',\n        values: [{ key: 'all', values: nested }],\n      };\n\n      // eslint-disable-next-line guard-for-in, no-restricted-syntax\n      for (const i in filters) {\n        inData = inData?.values?.filter?.((d) => d.key === filters[i])[0];\n      }\n\n      console.log('indata', inData);\n\n      return inData;\n    },\n    [data, filters, hierarchyBy],\n  );\n\n  useEffect(() => {\n    if (!svgRef.current) return;\n\n    console.log('nested', nestedData);\n    const svgHeight = svgRef.current.clientHeight;\n    console.log(svgHeight);\n\n    const root = d3.hierarchy(nestedData, (d) => d?.values)\n      .sum((d) => d?.value)\n      .sort((a, b) => b?.value - a?.value);\n\n    const treemap = d3.treemap()\n      .size([width - 2 * padding, svgHeight - 2 * padding])\n      .padding(3);\n      // .round(true);\n\n    const nodes = treemap(root);\n\n    const svg = d3.select(svgRef.current).select('g.chart');\n\n    const barScale = d3.scaleLinear()\n      .domain([0, d3.max(root.leaves(), (d) => d.value)])\n      .range([0, width - 2 * padding]);\n\n    const treemapPieceGroup = svg\n      .selectAll('g.treemap-piece')\n      .data(root.leaves(), (d) => d?.data?.key);\n\n    const treemapPieceGroupEnter = treemapPieceGroup\n      .enter()\n      .append('g')\n      .attr('class', 'treemap-piece');\n    // .attr('opacity', 0);\n\n    treemapPieceGroupEnter\n      .append('rect');\n    // .attr('x', d => d.x0)\n    // .attr('y', d => d.y0)\n    // .style('stroke', 'black')\n\n    // .style('fill', 'cyan');\n\n    treemapPieceGroupEnter\n      .append('text')\n      .attr('class', 'text-name')\n      .attr('font-size', '12px')\n      .attr('fill', 'white');\n\n    treemapPieceGroupEnter\n      .append('text')\n      .attr('class', 'text-value')\n      .attr('font-size', '12px')\n      .attr('fill', 'white');\n\n    const treemapPieceMerged = treemapPieceGroupEnter.merge(treemapPieceGroup);\n\n    if (displayMode === 'treemap') {\n      treemapPieceMerged\n        .on('click', null)\n        .on('click', (e, d) => {\n          const dx = d.x0;\n          const dy = d.y0;\n          const sx = (width - 2 * padding) / (d.x1 - d.x0);\n          const sy = (height - 2 * padding) / (d.y1 - d.y0);\n\n          treemapPieceMerged\n            .transition()\n            .duration(300)\n            .attr('transform', (p) => `translate(${(p.x0 - dx) * sx},${(p.y0 - dy) * sy})`);\n\n          // treemapPieceMerged\n          //   .transition()\n          //   .delay(500)\n          //   .duration(300)\n          //   .attr('opacity', 0);\n\n          treemapPieceMerged.select('rect')\n            .transition()\n            .duration(300)\n            .attr('width', (p) => sx * (p.x1 - p.x0))\n            .attr('height', (p) => sy * (p.y1 - p.y0));\n\n          // d3.select(this)\n          //   .classed('expanding', true)\n          //   .transition()\n          //   .duration(300)\n          //   .attr('transform', 'translate(0, 0)');\n\n          // const thisClicked = this;\n\n          // treemapPieceMerged\n          //   .filter(function (node, i, el) {\n          //     return this !== thisClicked;\n          //   })\n          //   .classed('not-current', true)\n          //   .transition()\n          //   .duration(300)\n          //   .attr('opacity', 0);\n\n          // d3.select(this).select('rect')\n          //   .attr('opacity', 1)\n          //   .transition()\n          //   .duration(300)\n          //   // .attr('x', (x) => -x.x0)\n          //   // .attr('y', (x) => -x.y0)\n          //   .attr('width', width - 2 * padding)\n          //   .attr('height', svgHeight - 2 * padding);\n\n          // // eslint-disable-next-line react/no-this-in-sfc\n\n          // d3.select(this)\n          //   .transition()\n          //   .duration(300)\n          //   .delay(500)\n          //   .attr('opacity', 0);\n\n          setTimeout(() => {\n            const newFilters = [...filters, d?.data?.key];\n            // setFilters(newFilters);\n            history.push(`${process.env.PUBLIC_URL}/${newFilters.join('/')}`);\n          }, 300);\n        })\n        .attr('transform', (d) => `translate(${d.x0},${d.y0})`)\n        .transition()\n        .duration(600)\n        .attr('opacity', 1);\n\n      treemapPieceMerged.select('rect')\n        .attr('rx', 2)\n        .style('fill', 'DarkSlateBlue')\n        .attr('width', (d) => d.x1 - d.x0)\n        .attr('height', (d) => d.y1 - d.y0);\n\n      treemapPieceMerged.select('text.text-name')\n        .attr('x', 5)\n        .attr('y', 20)\n        .text((d) => d?.data?.key);\n\n      treemapPieceMerged.select('text.text-value')\n        .attr('x', 5)\n        .attr('y', 36)\n        .attr('opacity', 1)\n        .text((d) => `${d.value.toLocaleString()} บาท`);\n    }\n    // else if (displayMode === 'bar') {\n    //   const Y_SPACING = 40;\n    //   treemapPieceMerged\n    //     .on('click', null)\n    //     .on('click', (e, d) => {\n    //       setFilters([...filters, d?.data?.key]);\n    //     })\n    //     .transition().duration(300)\n    //     .attr('transform', (d, i) => `translate(${0},${i * Y_SPACING + 30})`);\n\n    //   treemapPieceMerged.select('rect')\n    //     .transition().duration(300)\n    //     .attr('width', (d) => barScale(d.value))\n    //     .attr('height', 10);\n\n    //   treemapPieceMerged.select('text.text-name')\n    //     .transition().duration(300)\n    //     .attr('x', 0)\n    //     .attr('y', -4)\n    //     .attr('alignment-baseline', 'baseline')\n    //     .text((d) => `${d.data.key} - ${d.value.toLocaleString()} บาท`);\n\n    //   treemapPieceMerged.select('text.text-value')\n    //     .transition().duration(300)\n    //     .attr('opacity', 0);\n\n    //   svg.attr('height', root.leaves().length * Y_SPACING + 30);\n    // }\n\n    treemapPieceGroup.exit()\n      .transition()\n      .delay(300)\n      .duration(600)\n      .attr('opacity', 0)\n      .delay(300)\n      .remove();\n  }, [svgRef, nestedData, filters, width, height, displayMode, padding, history]);\n\n  return (\n    <div\n      ref={observe}\n      style={{\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        display: 'flex',\n        flexDirection: 'column',\n        overflowY: 'auto',\n      }}\n    >\n      {/* {JSON.stringify(filters)} */}\n      {isLoading\n        && (\n        <FullView\n          style={{\n            backgroundColor: '#000c',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          Loading...\n        </FullView>\n        )}\n\n      <div\n        style={{\n          height: padding,\n          marginBottom: -padding,\n          background: 'linear-gradient(#000f, #0000)',\n          width: '100%',\n          zIndex: 1,\n        }}\n      />\n      <svg ref={svgRef} width={width} height={height}>\n        <g transform={`translate(${padding}, ${padding})`} className=\"chart\" />\n      </svg>\n      <div\n        style={{\n          height: padding,\n          marginTop: -padding,\n          background: 'linear-gradient(#0000, #000f)',\n          width: '100%',\n          zIndex: 1,\n        }}\n      />\n    </div>\n  );\n}\n\nexport default Treemap;\n","import React, { useEffect, useMemo, useState } from 'react';\nimport * as d3 from 'd3';\nimport styled from 'styled-components';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport logo from './logo.svg';\nimport './App.css';\nimport Treemap from './components/Treemap';\nimport FullView from './components/FullView';\n\nconst TOP_BAR_HEIGHT = 60;\n\nconst hierarchyBy = [\n  'MINISTRY',\n  'BUDGETARY_UNIT',\n  'BUDGET_PLAN',\n  // 'OUPUT',\n  // 'PROJECT',\n  'OUTPUT_PROJECT',\n  'CATEGORY_LV1',\n  'CATEGORY_LV2',\n  'CATEGORY_LV3',\n  'CATEGORY_LV4',\n  'CATEGORY_LV5',\n  'CATEGORY_LV6',\n  'ITEM_DESCRIPTION',\n];\n\nfunction App() {\n  const [data, setData] = useState([]);\n  const [isLoading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [filters, setFilters] = useState(['all']);\n\n  useEffect(() => {\n    d3.csv(`${process.env.PUBLIC_URL}/data.csv`).then((d) => {\n      setLoading(false);\n      setData(d);\n    });\n  }, []);\n\n  const filterDataByQuery = (datum, query) => {\n    const searchLevels = [\n      'MINISTRY',\n      'BUDGETARY_UNIT',\n      // 'BUDGET_PLAN',\n      // 'OUPUT',\n      // 'PROJECT',\n      // 'OUTPUT_PROJECT',\n      // 'CATEGORY_LV1',\n      // 'CATEGORY_LV2',\n      // 'CATEGORY_LV3',\n      // 'CATEGORY_LV4',\n      // 'CATEGORY_LV5',\n      // 'CATEGORY_LV6',\n      // 'ITEM_DESCRIPTION',\n    ];\n    // eslint-disable-next-line guard-for-in, no-restricted-syntax\n    for (const i in searchLevels) {\n      if (datum[searchLevels[i]].includes(query)) { return true; }\n    }\n    return false;\n  };\n\n  const preprocessedData = useMemo(() => data\n    .map((d) => ({\n      ...d,\n      AMOUNT: parseFloat(d.AMOUNT.replace(/,/g, '')),\n      OUTPUT_PROJECT: d.OUTPUT + d.PROJECT,\n      MINISTRY: d.MINISTRY.replace(/\\([0-9]+\\)$/, '').trim(),\n    }))\n    .filter((d) => +d.FISCAL_YEAR === 2022)\n    .filter((d) => filterDataByQuery(d, searchQuery)),\n  [data, searchQuery]);\n\n  const location = useLocation();\n  const history = useHistory();\n\n  useEffect(() => {\n    const f = location.pathname.split('/').slice(2);\n    console.log('f', f, f.length > 0 && f[0] ? f : ['all']);\n    setFilters(f.length > 0 && f[0] ? f : ['all']);\n  }, [location]);\n\n  const navigateTo = (x, i) => {\n    console.log(x, i);\n    const temp = [...filters];\n    temp.splice(i + 1);\n    // setFilters(temp);\n    console.log('temp', temp);\n    history.push(`${process.env.PUBLIC_URL}/${temp.join('/')}`);\n  };\n\n  return (\n    <FullView>\n      <div style={{\n        height: TOP_BAR_HEIGHT,\n        display: 'flex',\n        alignItems: 'center',\n        paddingLeft: 16,\n        paddingRight: 16,\n        overflowX: 'auto',\n      }}\n      >\n        <div style={{\n          flexGrow: 1,\n          display: 'flex',\n          alignItems: 'center',\n        }}\n        >\n          {/* <button type=\"button\" onClick={() => setDisplayMode('treemap')}>treemap</button>\n        <button type=\"button\" onClick={() => setDisplayMode('bar')}>bar</button> */}\n\n          {filters.map((x, i) => (\n            <>\n              <button\n                type=\"button\"\n                onClick={() => navigateTo(x, i)}\n                style={{\n                  marginRight: 4,\n                  backgroundColor: 'transparent',\n                  border: 'none',\n                  color: 'white',\n                }}\n              >\n                <span style={{ opacity: '0.4' }}>{i > 0 && hierarchyBy[i - 1]}</span>\n                {i > 0 && <br />}\n                <span style={{ textDecoration: i < filters.length - 1 ? 'underline' : 'none' }}>\n                  {i === 0\n                    ? (\n                      searchQuery === ''\n                        ? 'หน่วยงานทั้งหมด'\n                        : `หน่วยงานทั้งหมดที่ชื่อมีคำว่า \"${searchQuery}\"`\n                    )\n                    : x}\n                </span>\n              </button>\n              {i < filters.length - 1\n                && <span style={{ color: 'white', marginRight: 4 }}>&gt;</span>}\n            </>\n          ))}\n          {/* {JSON.stringify(filters)} */}\n        </div>\n        <div>\n          <label>Filter: </label>\n          <input value={searchQuery} onInput={(e) => setSearchQuery(e.target.value)} placeholder=\"หน่วยรับงบหรือกระทรวง\" />\n        </div>\n      </div>\n      <div style={{\n        position: 'relative',\n        flexGrow: 1,\n      }}\n      >\n        <Treemap\n          data={preprocessedData}\n          isLoading={isLoading}\n          filters={filters}\n          hierarchyBy={hierarchyBy}\n          setFilters={setFilters}\n        />\n      </div>\n      <div\n        style={{\n          padding: 16,\n          paddingTop: 8,\n          fontSize: 12,\n          opacity: '0.7',\n        }}\n      >\n        **Work-In-Progress** Visualization by\n        {' '}\n        <a href=\"https://taepras.com\" style={{ color: 'white' }}>Thanawit Prasongpongchai</a>\n        , &shy;Data Source:\n        {' '}\n        <a href=\"https://docs.google.com/spreadsheets/d/1yyWXSTbq3CD_gNxks-krcSBzbszv3c_2Nq54lckoQ24/edit#gid=343539850\" style={{ color: 'white' }}>กลุ่มก้าว Geek</a>\n\n      </div>\n    </FullView>\n  );\n}\n\nexport default App;\n","const reportWebVitals = (onPerfEntry) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({\n      getCLS, getFID, getFCP, getLCP, getTTFB,\n    }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  useLocation,\n} from 'react-router-dom';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Router>\n      <App />\n    </Router>\n  </React.StrictMode>,\n  // eslint-disable-next-line no-undef\n  document.getElementById('root'),\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}