{"version":3,"sources":["logo.svg","components/FullView.jsx","components/Treemap.jsx","App.jsx","reportWebVitals.js","index.jsx"],"names":["FullView","styled","div","Treemap","data","isLoading","padding","filters","setFilters","hierarchyBy","useDimensions","onResize","observe","unobserve","w","h","entr","width","height","history","entry","useHistory","svgRef","useRef","useState","displayMode","nestedData","useMemo","console","log","out","nest","i","key","d","inData","values","rollup","leaves","d3","l","AMOUNT","entries","filter","useEffect","current","svgHeight","clientHeight","root","sum","value","sort","a","b","svg","size","treemap","select","treemapPieceGroup","domain","range","selectAll","treemapPieceGroupEnter","enter","append","attr","toLocaleString","treemapPieceMerged","merge","on","e","dx","x0","dy","y0","sx","x1","sy","y1","transition","duration","p","setTimeout","newFilters","length","push","join","style","text","exit","delay","remove","ReactTooltip","rebuild","ref","position","top","left","right","bottom","display","flexDirection","overflowY","backgroundColor","alignItems","justifyContent","marginBottom","background","zIndex","pointerEvents","transform","className","marginTop","THAI_NAME","MINISTRY","BUDGETARY_UNIT","BUDGET_PLAN","OUTPUT_PROJECT","ITEM","App","setData","setLoading","searchQuery","setSearchQuery","isCompareView","process","then","preprocessedData","map","parseFloat","replace","OUTPUT","PROJECT","trim","ITEM_DESCRIPTION","CATEGORY_LV2","CATEGORY_LV3","CATEGORY_LV4","CATEGORY_LV5","CATEGORY_LV6","x","FISCAL_YEAR","datum","query","searchLevels","includes","filterDataByQuery","location","useLocation","f","pathname","split","slice","paddingLeft","paddingRight","overflowX","flexGrow","type","onClick","temp","splice","navigateTo","marginRight","border","color","opacity","textDecoration","onInput","target","placeholder","paddingTop","fontSize","textAlign","href","multiline","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.e9571065.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.6ce24c58.svg\";","import React from 'react';\nimport styled from 'styled-components';\n\nconst FullView = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  flex-direction: column;\n`;\n\nexport default FullView;\n","import React, {\n  useEffect, useMemo, useRef, useState,\n} from 'react';\n\nimport * as d3 from 'd3';\nimport { nest } from 'd3-collection';\nimport useDimensions from 'react-cool-dimensions';\nimport ReactTooltip from 'react-tooltip';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport FullView from './FullView';\n\nconst THAI_NAME = {\n  MINISTRY: 'กระทรวงหรือเทียบเท่า',\n  BUDGETARY_UNIT: 'หน่วยรับงบฯ',\n  BUDGET_PLAN: 'แผนงาน',\n  OUTPUT_PROJECT: 'ผลผลิต/โครงการ',\n  ITEM: 'รายการ',\n};\n\nfunction Treemap({\n  data = [],\n  isLoading = true,\n  padding = 16,\n  filters = ['all'],\n  setFilters = () => { },\n  hierarchyBy = [],\n}) {\n  const {\n    observe, unobserve, width, height, entry,\n  } = useDimensions({\n    onResize: ({\n      /* eslint-disable-next-line no-shadow */\n      observe, unobserve, w, h, entr,\n    }) => {\n      unobserve();\n      observe();\n    },\n  });\n\n  const history = useHistory();\n\n  const svgRef = useRef(null);\n\n  // const [data, setData] = useState([]);\n  const [displayMode, setDisplayMode] = useState('treemap'); // or 'bar'\n\n  const nestedData = useMemo(\n    () => {\n      console.log('filters', filters);\n\n      let out = nest();\n      // eslint-disable-next-line guard-for-in, no-restricted-syntax\n      for (const i in filters) {\n      // for (const i in hierarchyBy) {\n        // console.log(hierarchyBy[i], filters[i])\n        out = out.key((d) => d[hierarchyBy[i]]);\n      }\n\n      const nested = out\n        .rollup((leaves) => d3.sum(leaves, (l) => l.AMOUNT))\n        .entries(data);\n\n      let inData = {\n        key: 'root',\n        values: [{ key: 'all', values: nested }],\n      };\n\n      // eslint-disable-next-line guard-for-in, no-restricted-syntax\n      for (const i in filters) {\n        inData = inData?.values?.filter?.((d) => d.key === filters[i])[0];\n      }\n\n      console.log('indata', inData);\n\n      return inData;\n    },\n    [data, filters, hierarchyBy],\n  );\n\n  useEffect(() => {\n    if (!svgRef.current) return;\n\n    console.log('nested', nestedData);\n    const svgHeight = svgRef.current.clientHeight;\n    console.log(svgHeight);\n\n    const root = d3.hierarchy(nestedData, (d) => d?.values)\n      .sum((d) => d?.value)\n      .sort((a, b) => b?.value - a?.value);\n\n    const treemap = d3.treemap()\n      .size([width - 2 * padding, svgHeight - 2 * padding])\n      .padding(3);\n      // .round(true);\n\n    const nodes = treemap(root);\n\n    const svg = d3.select(svgRef.current).select('g.chart');\n\n    const barScale = d3.scaleLinear()\n      .domain([0, d3.max(root.leaves(), (d) => d.value)])\n      .range([0, width - 2 * padding]);\n\n    const treemapPieceGroup = svg\n      .selectAll('g.treemap-piece')\n      .data(root.leaves(), (d) => d?.data?.key);\n\n    const treemapPieceGroupEnter = treemapPieceGroup\n      .enter()\n      .append('g')\n      .attr('class', 'treemap-piece')\n      .attr('data-tip', (d) => `${d?.data?.key}<br>${d?.value?.toLocaleString?.()} บาท`);\n    // .attr('opacity', 0);\n\n    treemapPieceGroupEnter\n      .append('rect');\n    // .attr('x', d => d.x0)\n    // .attr('y', d => d.y0)\n    // .style('stroke', 'black')\n\n    // .style('fill', 'cyan');\n\n    treemapPieceGroupEnter\n      .append('text')\n      .attr('class', 'text-name')\n      .attr('font-size', '12px')\n      .attr('fill', 'white');\n\n    treemapPieceGroupEnter\n      .append('text')\n      .attr('class', 'text-value')\n      .attr('font-size', '12px')\n      .attr('fill', 'white');\n\n    const treemapPieceMerged = treemapPieceGroupEnter.merge(treemapPieceGroup);\n\n    if (displayMode === 'treemap') {\n      treemapPieceMerged\n        .on('click', null)\n        .on('click', (e, d) => {\n          const dx = d.x0;\n          const dy = d.y0;\n          const sx = (width - 2 * padding) / (d.x1 - d.x0);\n          const sy = (height - 2 * padding) / (d.y1 - d.y0);\n\n          treemapPieceMerged\n            .transition()\n            .duration(300)\n            .attr('transform', (p) => `translate(${(p.x0 - dx) * sx},${(p.y0 - dy) * sy})`);\n\n          // treemapPieceMerged\n          //   .transition()\n          //   .delay(500)\n          //   .duration(300)\n          //   .attr('opacity', 0);\n\n          treemapPieceMerged.select('rect')\n            .transition()\n            .duration(300)\n            .attr('width', (p) => sx * (p.x1 - p.x0))\n            .attr('height', (p) => sy * (p.y1 - p.y0));\n\n          // d3.select(this)\n          //   .classed('expanding', true)\n          //   .transition()\n          //   .duration(300)\n          //   .attr('transform', 'translate(0, 0)');\n\n          // const thisClicked = this;\n\n          // treemapPieceMerged\n          //   .filter(function (node, i, el) {\n          //     return this !== thisClicked;\n          //   })\n          //   .classed('not-current', true)\n          //   .transition()\n          //   .duration(300)\n          //   .attr('opacity', 0);\n\n          // d3.select(this).select('rect')\n          //   .attr('opacity', 1)\n          //   .transition()\n          //   .duration(300)\n          //   // .attr('x', (x) => -x.x0)\n          //   // .attr('y', (x) => -x.y0)\n          //   .attr('width', width - 2 * padding)\n          //   .attr('height', svgHeight - 2 * padding);\n\n          // // eslint-disable-next-line react/no-this-in-sfc\n\n          // d3.select(this)\n          //   .transition()\n          //   .duration(300)\n          //   .delay(500)\n          //   .attr('opacity', 0);\n\n          setTimeout(() => {\n            const newFilters = [...filters, d?.data?.key];\n            // setFilters(newFilters);\n            if (newFilters.length <= hierarchyBy.length) {\n              history.push(`/${newFilters.join('/')}`);\n            }\n          }, 300);\n        })\n        .attr('transform', (d) => `translate(${d.x0},${d.y0})`)\n        .transition()\n        .duration(600)\n        .attr('opacity', 1)\n        .attr('data-tip', (d) => `${d?.data?.key}<br>${d?.value?.toLocaleString?.()} บาท`);\n\n      treemapPieceMerged.select('rect')\n        .attr('rx', 2)\n        .style('fill', 'DarkSlateBlue')\n        .attr('width', (d) => d.x1 - d.x0)\n        .attr('height', (d) => d.y1 - d.y0);\n\n      treemapPieceMerged.select('text.text-name')\n        .attr('x', 5)\n        .attr('y', 8)\n        .attr('dominant-baseline', 'hanging')\n        .text((d) => d?.data?.key);\n\n      treemapPieceMerged.select('text.text-value')\n        .attr('x', 5)\n        .attr('y', 24)\n        .attr('fill-opacity', 0.7)\n        .attr('dominant-baseline', 'hanging')\n        .attr('opacity', 1)\n        .text((d) => `${d.value.toLocaleString()} บาท`);\n    }\n    // else if (displayMode === 'bar') {\n    //   const Y_SPACING = 40;\n    //   treemapPieceMerged\n    //     .on('click', null)\n    //     .on('click', (e, d) => {\n    //       setFilters([...filters, d?.data?.key]);\n    //     })\n    //     .transition().duration(300)\n    //     .attr('transform', (d, i) => `translate(${0},${i * Y_SPACING + 30})`);\n\n    //   treemapPieceMerged.select('rect')\n    //     .transition().duration(300)\n    //     .attr('width', (d) => barScale(d.value))\n    //     .attr('height', 10);\n\n    //   treemapPieceMerged.select('text.text-name')\n    //     .transition().duration(300)\n    //     .attr('x', 0)\n    //     .attr('y', -4)\n    //     .attr('alignment-baseline', 'baseline')\n    //     .text((d) => `${d.data.key} - ${d.value.toLocaleString()} บาท`);\n\n    //   treemapPieceMerged.select('text.text-value')\n    //     .transition().duration(300)\n    //     .attr('opacity', 0);\n\n    //   svg.attr('height', root.leaves().length * Y_SPACING + 30);\n    // }\n\n    treemapPieceGroup.exit()\n      .transition()\n      .delay(300)\n      .duration(600)\n      .attr('opacity', 0)\n      .delay(300)\n      .remove();\n\n    ReactTooltip.rebuild();\n    console.log('rebuilding tooltip');\n\n    console.log('too small', root.leaves().filter((d) => (d.x1 - d.x0) * (d.y1 - d.y0) < 100));\n    console.log('too narrow', root.leaves().filter((d) => d.x1 - d.x0 < 20));\n    console.log('too short', root.leaves().filter((d) => d.y1 - d.y0 < 20));\n  }, [svgRef, nestedData, filters, width, height, displayMode, padding, history, hierarchyBy]);\n\n  return (\n    <div\n      ref={observe}\n      style={{\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        display: 'flex',\n        flexDirection: 'column',\n        overflowY: 'auto',\n      }}\n    >\n      {/* {JSON.stringify(filters)} */}\n      {isLoading\n        && (\n        <FullView\n          style={{\n            backgroundColor: '#000c',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          Loading...\n        </FullView>\n        )}\n\n      <div\n        style={{\n          height: padding,\n          marginBottom: -padding,\n          background: 'linear-gradient(#000f, #0000)',\n          width: '100%',\n          zIndex: 1,\n          pointerEvents: 'none',\n        }}\n      />\n      <svg ref={svgRef} width={width} height={height}>\n        <g transform={`translate(${padding}, ${padding})`} className=\"chart\" />\n      </svg>\n      <div\n        style={{\n          height: padding,\n          marginTop: -padding,\n          background: 'linear-gradient(#0000, #000f)',\n          width: '100%',\n          zIndex: 1,\n          pointerEvents: 'none',\n        }}\n      />\n    </div>\n  );\n}\n\nexport default Treemap;\n","import React, { useEffect, useMemo, useState } from 'react';\nimport * as d3 from 'd3';\nimport styled from 'styled-components';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport ReactTooltip from 'react-tooltip';\nimport logo from './logo.svg';\nimport './App.css';\nimport Treemap from './components/Treemap';\nimport FullView from './components/FullView';\n\nconst TOP_BAR_HEIGHT = 60;\n\nconst hierarchyBy = [\n  'MINISTRY',\n  'BUDGETARY_UNIT',\n  'BUDGET_PLAN',\n  // 'OUPUT',\n  // 'PROJECT',\n  'OUTPUT_PROJECT',\n  // 'CATEGORY_LV1',\n  'ITEM',\n  // 'CATEGORY_LV2',\n  // 'CATEGORY_LV3',\n  // 'CATEGORY_LV4',\n  // 'CATEGORY_LV5',\n  // 'CATEGORY_LV6',\n  // 'ITEM_DESCRIPTION',\n];\n\nconst THAI_NAME = {\n  MINISTRY: 'กระทรวงหรือเทียบเท่า',\n  BUDGETARY_UNIT: 'หน่วยรับงบฯ',\n  BUDGET_PLAN: 'แผนงาน',\n  OUTPUT_PROJECT: 'ผลผลิต/โครงการ',\n  ITEM: 'รายการ',\n};\n\nfunction App() {\n  const [data, setData] = useState([]);\n  const [isLoading, setLoading] = useState(true);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [isCompareView, setCompareView] = useState(false);\n  const [filters, setFilters] = useState(['all']);\n\n  useEffect(() => {\n    d3.csv(`${process.env.PUBLIC_URL}/data.csv`).then((d) => {\n      setLoading(false);\n      setData(d);\n    });\n  }, []);\n\n  const filterDataByQuery = (datum, query) => {\n    const searchLevels = [\n      'MINISTRY',\n      'BUDGETARY_UNIT',\n      // 'BUDGET_PLAN',\n      // 'OUPUT',\n      // 'PROJECT',\n      // 'OUTPUT_PROJECT',\n      // 'CATEGORY_LV1',\n      // 'CATEGORY_LV2',\n      // 'CATEGORY_LV3',\n      // 'CATEGORY_LV4',\n      // 'CATEGORY_LV5',\n      // 'CATEGORY_LV6',\n      // 'ITEM_DESCRIPTION',\n    ];\n    // eslint-disable-next-line guard-for-in, no-restricted-syntax\n    for (const i in searchLevels) {\n      if (datum[searchLevels[i]].includes(query)) { return true; }\n    }\n    return false;\n  };\n\n  const preprocessedData = useMemo(() => data\n    .map((d) => ({\n      ...d,\n      AMOUNT: parseFloat(d.AMOUNT.replace(/,/g, '')),\n      OUTPUT_PROJECT: (d.OUTPUT || d.PROJECT) ? (d.OUTPUT + d.PROJECT) : 'ไม่ระบุโครงการ/ผลผลิต',\n      MINISTRY: d.MINISTRY.replace(/\\([0-9]+\\)$/, '').trim(),\n      ITEM: [\n        d.ITEM_DESCRIPTION,\n        d.CATEGORY_LV2,\n        d.CATEGORY_LV3,\n        d.CATEGORY_LV4,\n        d.CATEGORY_LV5,\n        d.CATEGORY_LV6,\n      ]\n        .filter((x) => x)\n        .join(' - '),\n    }))\n    .filter((d) => +d.FISCAL_YEAR === 2022)\n    .filter((d) => filterDataByQuery(d, searchQuery)),\n  [data, searchQuery]);\n\n  const location = useLocation();\n  const history = useHistory();\n\n  useEffect(() => {\n    const f = location.pathname.split('/').slice(1);\n    console.log('f', f, f.length > 0 && f[0] ? f : ['all']);\n    setFilters(f.length > 0 && f[0] ? f : ['all']);\n  }, [location]);\n\n  const navigateTo = (x, i) => {\n    console.log(x, i);\n    const temp = [...filters];\n    temp.splice(i + 1);\n    // setFilters(temp);\n    console.log('temp', temp);\n    history.push(`/${temp.join('/')}`);\n  };\n\n  return (\n    <FullView>\n      {/*\n      <button type=\"button\" onClick={() => setCompareView(!isCompareView)}>\n      toggle compare view\n      </button>\n       */}\n      <div style={{\n        height: TOP_BAR_HEIGHT,\n        display: 'flex',\n        alignItems: 'center',\n        paddingLeft: 16,\n        paddingRight: 16,\n        overflowX: 'auto',\n      }}\n      >\n        <div style={{\n          flexGrow: 1,\n          display: 'flex',\n          alignItems: 'center',\n        }}\n        >\n          {/* <button type=\"button\" onClick={() => setDisplayMode('treemap')}>treemap</button>\n        <button type=\"button\" onClick={() => setDisplayMode('bar')}>bar</button> */}\n\n          {filters.map((x, i) => (\n            <>\n              <button\n                type=\"button\"\n                onClick={() => navigateTo(x, i)}\n                style={{\n                  marginRight: 4,\n                  backgroundColor: 'transparent',\n                  border: 'none',\n                  color: 'white',\n                }}\n              >\n                <small style={{ opacity: '0.4' }}>{i > 0 && THAI_NAME[hierarchyBy[i - 1]]}</small>\n                {i > 0 && <br />}\n                <span style={{ textDecoration: i < filters.length - 1 ? 'underline' : 'none' }}>\n                  {i === 0\n                    ? (\n                      searchQuery === ''\n                        ? 'หน่วยงานทั้งหมด'\n                        : `หน่วยงานทั้งหมดที่ชื่อมีคำว่า \"${searchQuery}\"`\n                    )\n                    : x}\n                </span>\n              </button>\n              {i === filters.length - 1\n                && (\n                <>\n                  <small style={{ color: 'white', marginRight: 8, opacity: '0.4' }}>\n                    :\n                  </small>\n                  <small style={{ color: 'white', marginRight: 4, opacity: '0.4' }}>\n                    แบ่งตาม\n                    {' '}\n                    {THAI_NAME[hierarchyBy[i]]}\n                  </small>\n                </>\n                )}\n              {i < filters.length - 1\n                && <span style={{ color: 'white', marginRight: 4 }}>&gt;</span>}\n            </>\n          ))}\n          {/* {JSON.stringify(filters)} */}\n        </div>\n        <div>\n          <label>Filter: </label>\n          <input value={searchQuery} onInput={(e) => setSearchQuery(e.target.value)} placeholder=\"หน่วยรับงบหรือกระทรวง\" />\n        </div>\n      </div>\n      <div style={{ display: 'flex', flexDirection: 'row', flexGrow: 1 }}>\n        <div style={{\n          position: 'relative',\n          flexGrow: 1,\n        }}\n        >\n          <Treemap\n            data={preprocessedData}\n            isLoading={isLoading}\n            filters={filters}\n            hierarchyBy={hierarchyBy}\n            setFilters={setFilters}\n          />\n        </div>\n        {isCompareView\n          && (\n          <div style={{\n            position: 'relative',\n            flexGrow: 1,\n          }}\n          >\n            <Treemap\n              data={preprocessedData}\n              isLoading={isLoading}\n              filters={filters}\n              hierarchyBy={hierarchyBy}\n              setFilters={setFilters}\n            />\n          </div>\n          )}\n      </div>\n      <div\n        style={{\n          padding: 16,\n          paddingTop: 8,\n          fontSize: 12,\n          opacity: '0.7',\n          display: 'flex',\n        }}\n      >\n        <div\n          style={{\n            position: 'relative',\n            flexGrow: 1,\n          }}\n        >\n          **Work-In-Progress**\n          <br />\n          โครงสร้างงบประมาณปี 65\n        </div>\n        <div style={{ textAlign: 'right' }}>\n          Visualization by\n          {' '}\n          <a href=\"https://taepras.com\" style={{ color: 'white' }}>Thanawit Prasongpongchai</a>\n          <br />\n          Data Source:\n          {' '}\n          <a href=\"https://docs.google.com/spreadsheets/d/1yyWXSTbq3CD_gNxks-krcSBzbszv3c_2Nq54lckoQ24/edit#gid=343539850\" style={{ color: 'white' }}>กลุ่มก้าว Geek</a>\n        </div>\n      </div>\n      <ReactTooltip multiline />\n    </FullView>\n  );\n}\n\nexport default App;\n","const reportWebVitals = (onPerfEntry) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({\n      getCLS, getFID, getFCP, getLCP, getTTFB,\n    }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport {\n  HashRouter as Router,\n  Switch,\n  useLocation,\n} from 'react-router-dom';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Router>\n      <App />\n    </Router>\n  </React.StrictMode>,\n  // eslint-disable-next-line no-undef\n  document.getElementById('root'),\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}